<!doctype html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Charles Troupin</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content=" ">
    <meta name="keywords" content="data analyst, engineering, oceanography, ocean science, numerical modelling" />
    <meta name="author" content="Troupin Charles">
    <link rel="canonical" href="https://ctroupin.github.io/posts/2019-09-26-wind-plot/">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">

    <!-- Custom CSS & Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
    <link rel="stylesheet" href="/style.css">

    <!-- Google verification -->
    

    <!-- Bing Verification -->
    

    <!-- Custom Fonts
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fontawesome.css">
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fontawesome-all.css">
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fa-brands.css">
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fa-regular.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/brands.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/regular.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/fontawesome.min.css">
    <link rel="stylesheet" href="/assets/css/academicons.css">
    <link href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>


<html lang="en-US">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<title>Charles Troupin by </title>

	<link rel="stylesheet" href="/assets/css/style.css?v=">

	<meta name="viewport" content="width=device-width">
	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

</head>

<body>

	<div class="container">
		<div class="col-lg-8 col-lg-offset-2">
			<center>
				<h2> Adding satellite wind on a visible image </h2>
			</center>
			<blogsection>
				 <div style="text-align:left; vertical-align: middle; ">
					
						<h4><i class="far fa-calendar-alt"></i></h4> 26 September 2019 &nbsp;
					
					
						<h4><i class="fas fa-wrench"></i></h4> Python, Basemap, Cartopy &nbsp;
					
					
						<h4><i class="fas fa-tags"></i></h4> Oceanography, Maps, Wind, Satellite &nbsp;
					
					
				</div>
				<p>How to create display wind vectors, measured by satellite, on top of true color image?</p>

<p><img src="https://ctroupin.github.io/figures/blog/terra-ascat.png" class="img-responsive" alt="Wind from ASCAT on Terra satellite" /></p>

<h2 id="data">Data</h2>

<p>We will play with:</p>
<ol>
  <li>Visible images (geoTIFF) download from <a href="https://apps.sentinel-hub.com/eo-browser">Sentinel-Hub</a> or from <a href="https://worldview.earthdata.nasa.gov/">WorldView</a>.</li>
  <li>Level-2 (swath) wind data from MetOp-A and Metop-B, distributed by <a href="https://podaac.jpl.nasa.gov/">PO.DAAC</a> (among others).</li>
</ol>

<p>Metop is a series of meteorological satellites managed by <a href="https://www.eumetsat.int">EUMETSAT</a>, the first one was launched in October 2010 and the most recent in November 2018.</p>

<h2 id="data-reading">Data reading</h2>

<h3 id="geotiff">geoTIFF</h3>

<p>We already showed how to get the coordinates from a <code class="language-plaintext highlighter-rouge">geoTIFF</code>, see for example <a href="2019-08-30-basemap_geotiff">this post</a>.    <br />
The only thing we need to ensure is to download the image with the good projection (<code class="language-plaintext highlighter-rouge">WGS 84</code>).</p>

<h3 id="scatterometer-wind">Scatterometer wind</h3>

<p>The wind fields are available as <code class="language-plaintext highlighter-rouge">netCDF</code> files from the JPL THREDDS data server.   <br />
Getting the wind intensity and direction is not a hard task, and converting to zonal and meridional components requires only a little bit of trigonometry (yes, sometimes people think nobody uses trigonometry after secondary school).</p>

<p>Still, there is a problem to solve: the wind files are organised by <em>day of the year</em> (1, 2, …, 365) and downloading all the files is not necessary since most of them have zero good measurements in the region of interest. This is easily solved using the <code class="language-plaintext highlighter-rouge">OPeNDAP</code> protocol, which allows us to get the variables we want without actually downloading the file. Then 2nd problem arises: to get the <code class="language-plaintext highlighter-rouge">OPeNDAP</code> URL, we need to know the file name, but its pattern does not allow us to construct it in an automatic way, as it depends on the time of acquisition.</p>

<p>For instance, one file corresponding to September 29, 2018, is named:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="trac"><code><span class="n">ascat_20180929_081200_metopa_61980_eps_o_coa_3201_ovw</span><span class="p">.</span><span class="n">l2</span><span class="p">.</span><span class="n">nc</span><span class="p">.</span><span class="n">gz</span>
</code></pre></div></div>
<p>Of course there is a logic in the naming (year, month, day, hour, swath number…), but let’s say it’s not logic enough to code that in a few minutes.</p>

<p>This leads us to the other solution: reading the HTML from the <code class="language-plaintext highlighter-rouge">THREDDS</code> catalog index and extract from it the different file paths for the corresponding day. Luckily there is a library to do that in a few lines: <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/#"><code class="language-plaintext highlighter-rouge">BeautifulSoup</code></a>: it makes it possible to parse the HTML and then get all the links in the document. I think people use it a lot when it comes to web scrapping.</p>

<h2 id="putting-all-the-pieces-together">Putting all the pieces together</h2>

<p>With the data at hand, the plot is done in a couple of lines using the <a href="https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.quiver.html"><code class="language-plaintext highlighter-rouge">quiver()</code></a> function (plot of vectors).    <br />
A color can be added to the arrows to depict the wind speed. The figure below provides an example with a tropical storm in the Atlantic Ocean on September 30, 2019. The visible image is taken from VIIRS (Visible Infrared Imaging Radiometer Suite).</p>

<p><img src="https://ctroupin.github.io/figures/blog/viirs-ascat.png" class="img-responsive" alt="Wind from ASCAT on September 30, 2019" /></p>

<h3 id="final-drawback">Final drawback</h3>

<p>The visible image and the winds are not necessarily acquired at the same time of the day, this can cause some discrepancies between the different layers of the images, for instance a storm that makes a long displacement, its center may not correspond to the center as depicted by the wind field.</p>

			</blogsection>
		</div>
	</div>
</body>

</body>
</html>
