<!doctype html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Charles Troupin</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content=" ">
    <meta name="keywords" content="data analyst, engineering, oceanography, ocean science, numerical modelling" />
    <meta name="author" content="Troupin Charles">
    <link rel="canonical" href="http://localhost:4000/posts/2020-06-22-animations/">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">

    <!-- Custom CSS & Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
    <link rel="stylesheet" href="/style.css">

    <!-- Google verification -->
    

    <!-- Bing Verification -->
    

    <!-- Custom Fonts
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fontawesome.css">
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fontawesome-all.css">
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fa-brands.css">
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fa-regular.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/regular.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css">
    <link rel="stylesheet" href="/assets/css/academicons.css">
    <link href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>


<html lang="en-US">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<title>Charles Troupin by </title>

	<link rel="stylesheet" href="/assets/css/style.css?v=">

	<meta name="viewport" content="width=device-width">
	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

</head>

<body>

	<div class="container">
		<div class="col-lg-8 col-lg-offset-2">
			<center>
				<h2> Creating animations from image sequences </h2>
			</center>
			<blogsection>
				 <div style="text-align:left; vertical-align: middle; ">
					
						<h4><i class="far fa-calendar-alt"></i></h4> 22 June 2020 &nbsp;
					
					
						<h4><i class="fas fa-wrench"></i></h4> bash, matplotlib, ffmpeg &nbsp;
					
					
						<h4><i class="fas fa-tags"></i></h4> Animations &nbsp;
					
					
				</div>
				<p>Creating animations is frequent in oceanography and modeling, as it is a perfect way
to show the temporal evolution of 2-dimensional fields, such as the sea water temperature.
This is also something useful to create <em>time-lapse</em>.
But how to create them? This is what I plan to explain here.</p>

<h2 id="the-principle">The principle</h2>

<p>There are several methods to produce animation, here we will use the image sequence technique:   <br />
we first produce a bunch of images that we later put together into an animation or movie. Why this approach? I think it provides a lot of flexibility, and it is very easy to modify the parameters (speed, quality) of the movie afterward.</p>

<h2 id="the-tools">The tools</h2>
<p>First we need tools:</p>
<ol>
  <li>For the preparation of the images, we use <code class="language-plaintext highlighter-rouge">python + matplotlib</code> or <code class="language-plaintext highlighter-rouge">Julia + PyPlot</code>. I won’t go into details here as the function <a href="https://matplotlib.org/3.2.1/api/_as_gen/matplotlib.pyplot.savefig.html">savefig</a> is well documented.</li>
  <li>For the animation creation, we work with <a href="https://ffmpeg.org/">ffmpeg</a>, my favorite tool to work on videos.</li>
</ol>

<h2 id="procedure">Procedure</h2>

<p>Now image we have a bunch a images, names sequentially, for example:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="trac"><code>north_sea001.png
north_sea002.png
north_sea003.png
...
</code></pre></div></div>
<p>and we want to create a movie called in <code class="language-plaintext highlighter-rouge">mp4</code> format.</p>

<p><img src="http://localhost:4000/figures/blog/Sentinel2_0022.png" class="img-responsive" alt="Sentinel-2 image" /></p>

<p>Here is an example of command we ca, use:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="trac"><code>ffmpeg <span class="nt">-framerate</span> 6 <span class="nt">-i</span> north_sea%03d.png <span class="nt">-c</span>:v libx264 <span class="nt">-pix_fmt</span> yuv420p animation.mp4
</code></pre></div></div>
<p>and now some explanations:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">-framerate 6</code> specifies the <em>framerate</em>, here 6 frames per second.</li>
  <li><code class="language-plaintext highlighter-rouge">-i north_sea%03d.png</code> indicates the input files, with the <code class="language-plaintext highlighter-rouge">%03</code> for the zero-padding.</li>
  <li><code class="language-plaintext highlighter-rouge">-c:v libx264</code> [optional] encodes the movie with <code class="language-plaintext highlighter-rouge">libx264</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">-pix_fmt yuv420p</code> [optional] to ensure the output work in <code class="language-plaintext highlighter-rouge">QuickTime</code> and most other players.</li>
</ul>

<p>And that’s all, the movie is ready to be played or uploaded to your favorite platform or even on social media (<em>Twitter</em> has a size limit for the animations).</p>

<h3 id="working-with-file-patterns">Working with file patterns</h3>

<p>In the initial example, the files were named sequentially. Usually I saved the
figures with a name containing the date, for instance <code class="language-plaintext highlighter-rouge">SST_201801.jpg</code>,
<code class="language-plaintext highlighter-rouge">SST_201802.jpg</code>, …, <code class="language-plaintext highlighter-rouge">SST_202012.jpg</code></p>

<p>Of course we can use some options to take care of that, in particular
the option <code class="language-plaintext highlighter-rouge">-pattern_type</code>. An example is better than explanations:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="trac"><code>ffmpeg <span class="nt">-framerate</span> 12 <span class="nt">-pattern_type</span> glob <span class="nt">-i</span> <span class="s2">"SST_*.jpg"</span> <span class="nt">-c</span>:v libx264 <span class="nt">-pix_fmt</span> yuv420p  animation.mp4
</code></pre></div></div>
<p>It is always possible to check a priori the file order using this command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="trac"><code><span class="nb">echo </span>SST_<span class="k">*</span>.png
</code></pre></div></div>
<p>ensuring there is no surprise in the final animation.</p>

<h3 id="errors">Errors</h3>

<p>Sometimes I had an error like this:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="trac"><code>libx264 @ 0x9a6460] width not divisible by 2 <span class="o">(</span>2441x2402<span class="o">)</span>
</code></pre></div></div>
<p>which was solved by adding this option <code class="language-plaintext highlighter-rouge">-vf "pad=ceil(iw/2)*2:ceil(ih/2)*2"</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="trac"><code>ffmpeg <span class="nt">-framerate</span> 6 <span class="nt">-i</span> north_sea%03d.png <span class="nt">-c</span>:v libx264 <span class="nt">-pix_fmt</span> yuv420p <span class="nt">-vf</span> <span class="s2">"pad=ceil(iw/2)*2:ceil(ih/2)*2"</span> animation.mp4
</code></pre></div></div>

<h2 id="examples">Examples</h2>

<p>Instead of showing an animation of ocean-related variables, I preferred an example of time-lapse
I did a few years ago: <a href="https://vimeo.com/271162965">https://vimeo.com/271162965</a>, hope you like it.</p>

			</blogsection>
		</div>
	</div>
</body>

</body>
</html>
