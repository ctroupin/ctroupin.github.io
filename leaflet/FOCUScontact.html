	<!DOCTYPE html>
	<html>
		<head>
			<meta charset="UTF-8"/>

			<meta name="viewport" content="width=device-width, initial-scale=1" />
			<title>
				Contacts for internships abroad
			</title>
			<script src ="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.js"></script>
			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.css" />
			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.3/Control.FullScreen.css">
			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.6/MarkerCluster.css">
			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.6/MarkerCluster.Default.css">
			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
			<script type="text/javascript" src="js/Leaflet.Geodesic.js"></script>
			<style type="text/css">
				#map { height : 800px; }
				.info { padding: 10px 20px; font: 20px/22px Arial, Helvetica, sans-serif; background: rgba(255,255,255,0.7);
					box-shadow: 0 0 15px rgba(0,0,0,0.4); border-radius: 7px; }
						.info h4 { margin: 0 0 5px; color: #777; }
				}

			</style>
		</head>
		<body>

			<div id="map"></div>
			<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
			<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.3/Control.FullScreen.min.js"></script>
			<script tupe="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.6/leaflet.markercluster.js"></script>
			<script type="text/javascript" src="js/Leaflet.CountrySelect.js"></script>
			<script type="text/javascript" src="js/basemaps.js"></script>
			<script src="data/contacts.dat"></script>

			<script>

			  var origin = [50.5887, 5.8699];
				var map = L.map('map', {
					fullscreenControl: true,
				}).setView(origin, 4);

				var select = L.countrySelect({title:'Pick a country!'});

				var Esri_OceanBasemap = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer/tile/{z}/{y}/{x}', {
					attribution: 'Tiles &copy; Esri &mdash; Sources: GEBCO, NOAA, CHS, OSU, UNH, CSUMB, National Geographic, DeLorme, NAVTEQ, and Esri',
					maxZoom: 13
				});

				var OpenStreetMap_BlackAndWhite = L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
					maxZoom: 18,
					attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
				});

				map.addLayer(OpenStreetMap_BlackAndWhite)

				var baseMaps = {
					"OpenStreetMap B&W": OpenStreetMap_BlackAndWhite,
					"Esri OceanBasemap": Esri_OceanBasemap,
					"OpenStreetMap": OpenStreetMap_Mapnik,
					"Stamen Terrain": Stamen_Terrain,
					"ESRI Dark Grey Canvas": Esri_DarkGreyCanvas,
				};

				// control that shows state info on hover
				var info = L.control({position: 'bottomright'});

				info.onAdd = function (map) {
					this._div = L.DomUtil.create('div', 'info');
					this.update();
					return this._div;
				};

				info.update = function () {
					this._div.innerHTML = ('Click on a marker to get informations');
				};

				info.addTo(map);

				var markers = L.markerClusterGroup({ disableClusteringAtZoom: 17 });

  			var ncontacts = contacts.length;
				console.log(ncontacts);

				var liege = new L.LatLng(50.633333, 5.566667);
				L.marker(liege).addTo(map);

				var GeodesicOptions = {
					weight: 2,
					opacity: .7,
					color: 'blue',
					steps: 40,
				};

				var theLine = {};
				function onClick(e) {
					if (theLine != undefined) {
              map.removeLayer(theLine);
        	};
					theLine = L.geodesic([[liege, this.getLatLng()]], GeodesicOptions).addTo(map);
				}

				function formatPopup(contact) {
					textpopup = "<a href=" + contact[3] + ">" + contact[0] + "</a><br>" + "<i class='fa fa-envelope'></i> " + contact[2];
					return textpopup;
				};

				for (var i = 0; i < ncontacts ; i++) {
					t = formatPopup(contacts[i]);
					m = L.marker(contacts[i][1]).bindPopup(t).on('click', onClick);
					markers.addLayer(m);
				}

				map.addLayer(markers);

				L.control.scale().addTo(map);
				L.control.layers(baseMaps, null, {autoZIndex:true, collapsed:false}).addTo(map);

				select.addTo(map);

				select.on('change', function(e){
					if (e.feature === undefined){ //Do nothing on title
						return;
					}
					var country = L.geoJson(e.feature);
					if (this.previousCountry != null){
						map.removeLayer(this.previousCountry);
					}
					this.previousCountry = country;

					map.addLayer(country);
					map.fitBounds(country.getBounds());

				});

			</script>

		</body>
	</html>
