<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>
	Grand Jogging de Verviers
  </title>

  <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.3/Control.FullScreen.css">
  <link rel="stylesheet" href="js/leaflet.awesome-markers.css">
  <link rel="stylesheet" href="css/leaflet-distance-marker.css" media="screen"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<style>
		#descr {font-size: 1.5em; width: 30% ; margin: 2% ; float: left ; text-align: justify}
		#map {height: 600px; width: 50% ; margin: 2% ; float: right}
  </style>
  <!--[if lte IE 8]>
      <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
  <![endif]-->
</head>
<body>
  <div id="descr">
			
		<h2>Grand Jogging de Verviers</h2>
	
		The Jogging is probably the most popular sport event in the area, hence it deserves a proper map.
		<ul>
		<li><b>Modules:</b> 
			<ol>
			<li><a href="https://github.com/mapbox/leaflet-omnivore" title="leaflet-omnivore">leaflet-omnivore</a> to parse the coordinates from the GPX file.</li>
			<li><a href="https://github.com/adoroszlai/leaflet-distance-markers" title="leaflet-distance-marker">leaflet-distance-marker</a> 
			to add markers every kilometer.</li>
			<li><a href="https://github.com/lvoogdt/Leaflet.awesome-markers" title="leaflet.awesome-markers">leaflet.awesome-markers</a> 
			for the start (<i>play</i>) and finish (<i>stop</i>) locations.</li>
			</ol>
		</li>
	
		<li><b>Data source:</b> the track has been acquired by a Suntoo Ambit 3 device on June 18, 2017 (the day of the race). 
		The file has been exported from movescount interface in GPX format. 
		
		<li><b>Processing:</b> no processing was applied to the coordinates. 
		An auxiliary track was created with only the coordinates corresponding to the Grand Prix de la Montagne (GPM) and 
		then overlayed on the complete track.</li>
		</ul>
		
		
		</div>
		<div id="map"></div>	
  
		  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-omnivore/0.3.4/leaflet-omnivore.js"></script>
		  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.3/Control.FullScreen.min.js"></script>
		  <script src="js/leaflet.awesome-markers.js"></script>
		  <script src="js/leaflet-distance-marker.js" type="text/javascript"></script>
		  <script src="js/leaflet.geometryutil.js" type="text/javascript"></script>
		  <script src="data/ravitaillement.js"></script>	
		  <script>
			var map = L.map('map', {fullscreenControl: true}).setView([50.582, 5.8574], 14);;

			var OpenStreetMap_Mapnik = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
						maxZoom: 19,
						attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
			});
			
			var CartoDB = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', {
				maxZoom: 18, 
				attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; <a href="https://carto.com/attribution">CARTO</a>'
			  });

			var baseMaps = {
				"CartoDB": CartoDB,
				"OpenStreetMap": OpenStreetMap_Mapnik
			};
			
			map.addLayer(OpenStreetMap_Mapnik)
			
			var bottleIcon = L.icon({
			iconUrl: './images/bottle.png',
			//iconSize:     [38, 95], // size of the icon
			iconAnchor:   [0, 20], // point of the icon which will correspond to marker's location
			//popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
			});
			
			
			var ravitoList = [];
			for ( var i=0; i < ravitaillements.length; ++i ) 
			{
				var marker = L.marker([ravitaillements[i][0], ravitaillements[i][1]], {icon: bottleIcon});
				marker.bindPopup("<b>" + ravitaillements[i][2] + "</b>");
				ravitoList.push(marker);
			}
			
			var ravitaillements = L.layerGroup(ravitoList);
			ravitaillements.addTo(map);
			
			
			var customLayer = L.geoJson(null, {
				style: function(feature) {
					return { 
						color: 'blue',
						weight: 3, 
						opacity: .85
						};
				}
			});
			
			var gpmLayer = L.geoJson(null, {
				style: function(feature) {
					return { 
						color: 'red',
						weight: 5, 
						opacity: .9
						};
				}
			});
			
			var Parcours = omnivore.gpx('data/JoggingVerviers2017.gpx', null, customLayer);
			Parcours.addTo(map);
			var GPM = omnivore.gpx('data/JoggingVerviersGPDM.gpx', null, gpmLayer);
			GPM.addTo(map);
			GPM.bringToFront();
					
			L.marker([50.58620, 5.87271], {icon: L.AwesomeMarkers.icon({icon: 'play', prefix: 'fa', markerColor: 'green', iconColor: 'white'}) }).addTo(map);
			L.marker([50.58522, 5.87243], {icon: L.AwesomeMarkers.icon({icon: 'stop', prefix: 'fa', markerColor: 'green', iconColor: 'white'}) }).addTo(map);
					
			var overlayers = {
				"Parcours": Parcours,
				"Grand Prix de la Montagne": GPM,
				"Ravitaillements": ravitaillements
			};
			
			L.control.layers(baseMaps, overlayers, {autoZIndex:false, collapsed:false}).addTo(map);	
			

				
		  </script>
	</body>
</html>
