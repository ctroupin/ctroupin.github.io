<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Charles Troupin</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Tryin' to turn ocean data into stories">
    <meta name="keywords" content="data analyst, engineering, oceanography, ocean science, numerical modelling" />
    <meta name="author" content="Troupin Charles">
    <link rel="canonical" href="http://localhost:4000/maps/2017-04-02-Mallorca-Airbnb/">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">

    <!-- Custom CSS & Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
    <link rel="stylesheet" href="/style.css">

    <!-- Google verification -->
    

    <!-- Bing Verification -->
    

    <!-- Custom Fonts -->
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fontawesome.css">
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fontawesome-all.css">
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fa-brands.css">
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fa-regular.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/css/academicons.css">
    <link href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>


<!-- Navigation -->
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://localhost:4000">Charles Troupin</a>
        </div>
    </div>
    <!-- /.container-fluid -->
</nav>

<!-- Header -->
<header>
    <div class="container">
        <h2>Maps</h2>
    </div>
</header>

<head>
    <meta charset="utf-8">

    <script src ="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.3/Control.FullScreen.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.3.0/MarkerCluster.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.3.0/MarkerCluster.Default.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-groupedlayercontrol/0.6.1/leaflet.groupedlayercontrol.min.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/togeojson/0.16.0/togeojson.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-omnivore/0.3.4/leaflet-omnivore.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.3/Control.FullScreen.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.6/leaflet.markercluster.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-groupedlayercontrol/0.6.1/leaflet.groupedlayercontrol.js"></script>
    <script type="text/javascript" src="/leaflet/js/Leaflet.Geodesic.js"></script>
    <script type="text/javascript" src="/leaflet/js/basemaps.js"></script>
    <link rel="stylesheet" href="/leaflet/css/ionicons.min.css">
    <style type="text/css">
      #map {
        width:100%;
        height:450px;
      }
      #map2points {
        width:100%;
        height:450px;
      }
      #mapfarthestairports {
        width:100%;
        height:450px;
      }
      .awesome-marker i {
          font-size: 18px;
          margin-top: 5px;
      }
      .info { padding: 6px 8px; font: 18px/20px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; } .info h4 { margin: 0 0 5px; color: #777; }
      .legend { text-align: left; line-height: 18px; color: #555; } .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }
      .popupCustom .leaflet-popup-tip,
      .popupCustom .leaflet-popup-content-wrapper {
          background: #e0e0e0;
          color: #234c5e;
      }
    </style>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>


<body>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2">
                <h3> Airbnb in Mallorca </h3>
                <div style="text-align:left; vertical-align: middle; ">
                    
                    <h4><i class="far fa-calendar-alt"></i></h4> 02 April 2017 &nbsp;
                    
                    
                    <h4><i class="fas fa-wrench"></i></h4> Leaflet, Python &nbsp;
                    
                    
                    
                    <h4><i class="fab fa-github"></i></h4> <a href=http://github.com/Mallorca-Airbnb-Maps> Mallorca-Airbnb-Maps </a> &nbsp;
                    
                    
                </div>
                <p>After 4 years spent in Mallorca, it’s not a surprise to know that <em>Airbnb</em> is creating a lot of trouble there (and I guess also making some people richer). Once I discovered the nice work done by <a href="http://insideairbnb.com/">Inside Airbnb</a> and decided to work a little bit on their datasets.</p>

<p>Most of this work has been prepared in airports, planes and trains… during an intense month of traveling.</p>

<h3 id="data-density">Data density</h3>

<p>The spatial distribution of properties managed by <em>Airbnb</em> is a good starting point: we see that almost all the island is covered, not only the coastline of the Palma town. What caught my eyes was in fact the areas without (almost) any properties: in the northern part of the island, but ok, that’s expected (if you know the island): the <em>Tramuntana</em> is there. But still, even in the small villages (Sóller, Deià, Valldemossa, …), once can find a place to stay.</p>

<p><img src="http://localhost:4000/figures/blog/mallorca-heat.png" class="img-responsive" alt="Mallorca heatmap" /></p>

<h3 id="choropleth">Choropleth</h3>

<p>Here the plan is to show the density of properties (i.e. the number of properties relative to the population of each municipality), because having 100 in Palma is not the same as having 100 in Santa Margalida.</p>

<div id="map"></div>
<script type="text/javascript" src="../data/MallorcaHabitantsRooms.geojson"></script>

<script type="text/javascript" src="../data/airbnbMallorca20170315.js"></script>

<script>

	var map = L.map('map',
						{
						fullscreenControl: true,
						}
					).setView([39.6, 2.93], 9);

	OpenStreetMap_Mapnik.addTo(map);

	var baseMaps = {
		"CartoDB": CartoDB,
		"CartoDB Dark": CartoDB_DarkMatter,
		"OpenStreetMap": OpenStreetMap_Mapnik,
	};

	// control that shows state info on hover
	var info = L.control();

	info.onAdd = function (map) {
		this._div = L.DomUtil.create('div', 'info');
		this.update();
		return this._div;
	};

	info.update = function (props) {
		this._div.innerHTML = (props ?
			'<h4>' + props.NAME_4 + ':</h4> ' + props.habitants + ' habitants<br/>' + props.rooms + ' properties<br/>' + props.roomsPerHabitants + ' properties per 1000 hab.<br/>'
			: 'Select a location');
	};

	info.addTo(map);

	var geojson;

	function getColor(d) {
		return d > 100 ? '#E30002' :
			   d > 75  ? '#FC4E2A' :
			   d > 50  ? '#FD8D3C' :
			   d > 25  ? '#FEB24C' :
			   d > 10  ? '#FED976' :
						 '#FFF2BA';
	}

	function getColor(d) {
		return d > 100 ? '#253494' :
			   d > 75  ? '#2c7fb8' :
			   d > 50  ? '#41b6c4' :
			   d > 25  ? '#7fcdbb' :
			   d > 10  ? '#c7e9b4' :
						 '#ffffcc';
	}

	var heatStyle = {
		gradient : {.65: "white", .75:"#FFFF36", .85:"#FF9D00", .9:"#FF1700", .95:"#900000", 1:"black"},
		minOpacity: 0.75,
						radius: 7,
						blur: 7,
	};


	function style(feature) {
		return {
			fillColor: getColor(feature.properties.roomsPerHabitants),
			weight: 1,
			opacity: 1,
			color: 'black',
			dashArray: '2',
			fillOpacity: 0.7
		};
	}

	function highlightFeature(e) {
		var layer = e.target;

		layer.setStyle({
			weight: 5,
			color: '#666',
			dashArray: '',
			fillOpacity: 0.4
		});

		if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
			layer.bringToFront();
		}

		info.update(layer.feature.properties);
	}

	function resetHighlight(e) {
		geojson.resetStyle(e.target);
		info.update();
	}

	function zoomToFeature(e) {
		map.fitBounds(e.target.getBounds());
	}


	function onEachFeature(feature, layer) {
		layer.on({
			mouseover: highlightFeature,
			mouseout: resetHighlight,
			click: zoomToFeature
		});
	}

	geojson = L.geoJson(municipios, {
		style: style,
		onEachFeature: onEachFeature
	}).addTo(map);

	var heatmap = L.heatLayer(points.coordinates, heatStyle);

	var legend = L.control({position: 'bottomright'});
	legend.onAdd = function (map) {

		var div = L.DomUtil.create('div', 'info legend'),
			grades = [10, 25, 50, 75, 100],
			labels = [],
			from, to;

		//for (var i = 0; i < grades.length; i++) {
		for (var i = grades.length-1; i >= 0; i--) {
			from = grades[i];
			to = grades[i + 1];

			labels.push(
				'<i style="background:' + getColor(from + 1) + '"></i> ' +
				from + (to ? '&ndash;' + to : '+'));
		}

		div.innerHTML = labels.join('<br>');
		return div;
	};

	legend.addTo(map);

	var overlayers = {
		"Choropleth" : geojson,
		"Heatmap": heatmap
	};

	L.control.layers(baseMaps, overlayers).addTo(map);

</script>

<p><br /></p>

<p>For me the most striking feature I see here is the high density in Búger, a small village where I never really heard of, except when I was driving from Palma to Pollença. It seems other people were surprised by that, as you can see in this newspaper article: <a href="http://www.diariodemallorca.es/mallorca/2017/06/05/airbnbuger/1221084.html">Airbnb Búger</a>.</p>

<h4 id="top-3">Top 3</h4>
<ol>
  <li>Deyá</li>
  <li>Banyalbufar</li>
  <li>Búger</li>
</ol>

<p>all of them with more than 1 property for 10 habitants. The first two are located in the Tramuntana, but not far from the coast, with amazing views on the sea.</p>

<h4 id="least-popular-places">Least <em>popular</em> places</h4>
<ol>
  <li>Marratxí</li>
  <li>Consell</li>
  <li>Inca</li>
</ol>

<p>Marratxí is located very near to Palma, and some friends used to call it “a dormitory town”, a place where people live to save money on the loan, but that has not a lot of services and activities to offer. I must admit I don’t know if it’s true.   <br />
Number 3, Inca, is in fact one of the largest town of the Balearic Islands, it has a lot of shops, restaurants, even an hospital, and it is not far from the Tramuntana, but tourists don’t seem to like it to stay for a long time.</p>

<h3 id="processing">Processing</h3>

<p>The coordinates of each property are extracted from the <code class="highlighter-rouge">CSV</code> file provided by <a href="http://insideairbnb.com/">Inside Airbnb</a>.
We combined this information with a <code class="highlighter-rouge">geoJSON</code> file storing the municipality limits, to which we added a new properties <em>roomsPerHabitants</em>. Once the file is prepared, leaflet can easily use it as a layer and add some control (<code class="highlighter-rouge">mouseover</code>, <code class="highlighter-rouge">mouseout</code> and <code class="highlighter-rouge">click</code>).</p>

<h4 id="data-sources">Data sources</h4>

<ul>
  <li><a href="http://www.ine.es/">National Institute of Statistics</a> (INE, Spain).</li>
  <li><a href="http://insideairbnb.com/">InsideAirbnb</a>, licensed by a  <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons BY 3.0.</a></li>
</ul>

<h4 id="code">Code</h4>

<p>It is available on GitHub: <a href="Mallorca-Airbnb-Maps">https://github.com/ctroupin/Mallorca-Airbnb-Maps</a>.   <br />
With some time I would like to do the same for different years (2016, 2017, 2018), unfortunately there are more urgent topics at the moment.</p>

            </div>
        </div>
    </div>
</body>

    <!-- Footer -->
    <footer class="text-center">
        <div class="footer-above">
            <div class="container">
                <div class="row">
                    <div class="footer-col col-md-3">
                        <h3>Location</h3>
                        <p>
                            
                                Verviers, Liège <br>
		                    
                                Belgium <br>
		                    
                        </p>
                    </div>
                    <div class="footer-col col-md-9">
                        <h3>Credits</h3>
                        <p>Style based on <a href="https://github.com/jeromelachaud/freelancer-theme">Freelancer Jekyll theme</a> by jeromelachaud. Freelancer is a free to use, open source Bootstrap theme created by <a href="http://startbootstrap.com">Start Bootstrap</a>.</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-below">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        Copyright &copy; Charles Troupin 2019
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
    <div class="scroll-top page-scroll visible-xs visible-sm">
        <a class="btn btn-primary" href="#page-top">
            <i class="fa fa-chevron-up"></i>
        </a>
    </div>

 <!-- jQuery Version 1.11.0 -->
    <script src="/js/jquery-1.11.0.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="/js/jquery.easing.min.js"></script>
    <script src="/js/classie.js"></script>
    <script src="/js/cbpAnimatedHeader.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="/js/jqBootstrapValidation.js"></script>
    
    <script src="/js/contact_me_static.js"></script>
    

    <!-- Custom Theme JavaScript -->
    <script src="/js/freelancer.js"></script>

</body>
