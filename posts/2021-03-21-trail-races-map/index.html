<!doctype html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Charles Troupin</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Turning ocean data into stories">
    <meta name="keywords" content="data analyst, engineering, oceanography, ocean science, numerical modelling" />
    <meta name="author" content="Troupin Charles">
    <link rel="canonical" href="https://ctroupin.github.io/posts/2021-03-21-trail-races-map/">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">

    <!-- Custom CSS & Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
    <link rel="stylesheet" href="/style.css">

    <!-- Google verification -->
    

    <!-- Bing Verification -->
    

    <!-- Custom Fonts
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fontawesome.css">
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fontawesome-all.css">
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fa-brands.css">
    <link rel="stylesheet" href="/assets/css/font-awesome/css/fa-regular.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/brands.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/regular.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/fontawesome.min.css">
    <link rel="stylesheet" href="/assets/css/academicons.css">
    <link href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>


<html lang="en-US">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<title>Charles Troupin by </title>

	<link rel="stylesheet" href="/assets/css/style.css?v=">

	<meta name="viewport" content="width=device-width">
	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

</head>

<body>

	<div class="container">
		<div class="col-lg-8 col-lg-offset-2">
			<center>
				<h2> Gran Canaria trail running race maps </h2>
			</center>
			<blogsection>
				 <div style="text-align:left; vertical-align: middle; ">
					
						<h4><i class="far fa-calendar-alt"></i></h4> 28 July 2021 &nbsp;
					
					
						<h4><i class="fas fa-wrench"></i></h4> gpsbabel, Leaflet, Python &nbsp;
					
					
						<h4><i class="fas fa-tags"></i></h4> Maps &nbsp;
					
					
				</div>
				<p>It’s not a secret: I often mix 2 of my passions: trail running and maps. This time
I’m trying to display all the trail or mountain races taking place in the island
of Gran Canaria. This is how it goes.</p>

<p><img src="https://ctroupin.github.io/figures/blog/GCraces/GC_races.jpg" class="img-responsive" /></p>

<h2 id="the-data">The data</h2>

<p>There are 2 main ways to find the tracks:</p>
<ol>
  <li>By searching on the race web pages: there is often a section called “<em>Recorridos</em>”, where the track is available.</li>
  <li>By searching in <a href="wikiloc.com/">Wikiloc</a>: it is frequent that organisers or runners upload their tracks there.</li>
</ol>

<p>The difficulty is to find the name of races that don’t exist anymore. Sometimes there are still old calendars with the name of the competitions. This is the information I used to prepare the map.</p>

<h2 id="the-tools">The tools</h2>

<p>For most of the operations on the track files, I use <a href="https://www.gpsbabel.org/">GPSBabel</a>.   <br />
For the visualisation part, the excellent <a href="https://leafletjs.com/">Leaflet</a>.</p>

<h2 id="the-pre-processing">The pre-processing</h2>

<p>As usual, a few steps to clean or simplify the files. There is no need to show thousand of points for dozen of tracks, we can clearly simplify them.</p>

<p>As I prefer to work with <code class="highlighter-rouge">GPX</code> files, it happens that a conversion is needed, for example from a <code class="highlighter-rouge">kml</code> file:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="trac"><code>gpsbabel <span class="nt">-i</span> kml <span class="nt">-f</span> doc.kml <span class="nt">-o</span> gpx <span class="nt">-F</span> la-brena-trail-20k.gpx
</code></pre></div></div>

<p>Some tracks also contain way points and routes, which we clearly don’t need:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="trac"><code>gpsbabel <span class="nt">-i</span> gpx <span class="nt">-f</span> Teror-ElAlamo-.gpx <span class="nt">-x</span> nuketypes,waypoints,routes <span class="nt">-o</span> gpx <span class="nt">-F</span>  Teror-ElAlamo-.gpx
</code></pre></div></div>

<p>Reducing each track to a set of 500 points also helps keep the file size low:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="trac"><code>gpsbabel <span class="nt">-r</span> <span class="nt">-i</span> gpx <span class="nt">-f</span> Tejeda-CircularLarga-47km.gpx <span class="nt">-x</span> simplify,count<span class="o">=</span>500 <span class="nt">-o</span> gpx <span class="nt">-F</span> Tejeda-CircularLarga-47km.gpx
</code></pre></div></div>

<p>Finally, we remove the time and just keeping the coordinates; I guess it can be done
with <code class="highlighter-rouge">GPSBabel</code>, I did it with <code class="highlighter-rouge">sed</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="trac"><code><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'/&lt;time&gt;/d'</span> <span class="k">*</span>gpx
</code></pre></div></div>

<h2 id="the-plotting">The plotting</h2>

<p>Python + matplotlib + cartopy will do the trick. I used a Sentinel-2 images as the map background, downloaded from <a href="https://apps.sentinel-hub.com/eo-browser">Sentinel hub</a>
in geoTIFF format.</p>

<p>The GPX files are easily read, for instance using <a href="https://github.com/tkrajina/gpxpy">gpxpy</a>, then added to the map.</p>

<p>Finally, a little bit of decoration, with some points of interest, and we’re done.</p>

<p><img src="https://ctroupin.github.io/figures/blog/GCraces/GC_races5.jpg" class="img-responsive" /></p>

<p>What clearly appears is the heterogeneous coverage of the island. The northwestern
quadrant (Agaete, Artenra, Cruz de Tejeda…) seems very popular. The southestern side is almost empty, but that may be because we did not search enough. Or the dry landscapes are not so nice for a race.</p>

<p>There are a few tracks in the south, most of the time they are ultra-marathon that cross the island and start or finish there. This is what we show in the next map, which combines all the <em>TransGranCanaria</em> races I could find.</p>

<p><img src="https://ctroupin.github.io/figures/blog/GCraces/TGC_all12.jpg" class="img-responsive" /></p>

			</blogsection>
		</div>
	</div>
</body>

</body>
</html>
